<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripBuddy - Input System</title>
    
    <!-- ‡πÇ‡∏´‡∏•‡∏î Library ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/htm@3.1.1/dist/htm.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700;800&display=swap');
        body { font-family: 'Sarabun', sans-serif; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(3deg); }
            50% { transform: translateY(-10px) rotate(-1deg); }
        }
        .animate-float { animation: float 4s ease-in-out infinite; }
        .bg-fun-gradient { background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%); }
        
        #boot-loader {
            position: fixed; inset: 0; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            transition: opacity 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î -->
    <div id="boot-loader">
        <div class="text-center">
            <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="font-bold text-slate-400 text-xs tracking-widest uppercase text-sm">TripBuddy Loading...</p>
        </div>
    </div>

    <div id="root"></div>

    <script>
        const html = htm.bind(React.createElement);
        const { useState, useEffect, useMemo, useCallback } = React;

        /**
         * BULLETPROOF ICONS (Inline SVG) - ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏•
         */
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                MapPin: html`<path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>`,
                Sun: html`<circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>`,
                Palmtree: html`<path d="M13 8c0-2.76-2.46-5-5.5-5S2 5.24 2 8h2l1-1 1 1h4"/><path d="M13 7.14A5.82 5.82 0 0 1 16.5 6c3.04 0 5.5 2.24 5.5 5h-3l-1 1-1-1h-3"/><path d="M11 15.5c.5 2.5-.5 4.5-2.5 6.5"/><path d="M13 15.5c-.5 2.5.5 4.5 2.5 6.5"/>`,
                Sparkles: html`<path d="m12 3 1.91 5.81L20 10.73l-4.73 4.49L16.36 21 12 18.27 7.64 21l1.09-5.78L4 10.73l6.09-1.92L12 3Z"/>`,
                CheckCircle: html`<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>`,
                LogOut: html`<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/>`,
                ChevronLeft: html`<polyline points="15 18 9 12 15 6"/>`,
                ChevronRight: html`<polyline points="9 18 15 12 9 6"/>`,
                Info: html`<circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="16" y2="12"/><line x1="12" x2="12.01" y1="8" y2="8"/>`,
                Check: html`<polyline points="20 6 9 17 4 12"/>`,
                Users: html`<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>`,
                Plus: html`<line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/>`,
                ThumbsUp: html`<path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/>`,
                Clock: html`<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>`,
                Home: html`<path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>`
            };
            return html`
                <svg xmlns="http://www.w3.org/2000/svg" width=${size} height=${size} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0 ${className}">
                    ${icons[name] || null}
                </svg>
            `;
        };

        const HARDCODED_SHEET_URL = "https://script.google.com/macros/s/AKfycbz5nukgyV2w5goNKakjYkKrtWvk9l6MUgAg_WCJyhlKlexWgxf8ifS6YtjNXuIesm4t/exec"; 

        const App = () => {
            const [userName, setUserName] = useState('');
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [activeTab, setActiveTab] = useState('availability');
            const [isSaving, setIsSaving] = useState(false);
            const [showSuccessModal, setShowSuccessModal] = useState(false);
            const [data, setData] = useState({ availabilities: [], destinations: [], preferences: { durationVotes: {}, accommodationVotes: {} } });
            const [newLocationName, setNewLocationName] = useState('');
            const [viewMonth, setViewMonth] = useState(new Date(2026, 0, 1));

            useEffect(() => {
                const loader = document.getElementById('boot-loader');
                if (loader) { loader.style.opacity = '0'; setTimeout(() => loader.remove(), 300); }
            }, []);

            const fetchData = useCallback(async () => {
                if (!HARDCODED_SHEET_URL) return;
                try {
                    const res = await fetch(HARDCODED_SHEET_URL);
                    const result = await res.json();
                    if (result) {
                        setData({
                            availabilities: result.availabilities || [],
                            destinations: result.destinations || [],
                            preferences: result.preferences || { durationVotes: {}, accommodationVotes: {} }
                        });
                    }
                } catch (e) { console.error(e); }
            }, []);

            useEffect(() => { fetchData(); }, [fetchData]);

            const syncToCloud = async (newData, showModal = false) => {
                if (!HARDCODED_SHEET_URL) return;
                setIsSaving(true);
                try {
                    await fetch(HARDCODED_SHEET_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ type: 'UPDATE_ALL', data: newData }) });
                    if (showModal) { setShowSuccessModal(true); setTimeout(() => setShowSuccessModal(false), 3000); }
                } catch (e) { console.error(e); }
                finally { setIsSaving(false); }
            };

            const months = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
            const daysInMonth = useMemo(() => {
                const date = new Date(viewMonth.getFullYear(), viewMonth.getMonth(), 1);
                const days = [];
                while (date.getMonth() === viewMonth.getMonth()) { days.push(new Date(date)); date.setDate(date.getDate() + 1); }
                return days;
            }, [viewMonth]);

            const toggleDateStatus = (dateStr) => {
                const newData = { ...data };
                let user = (newData.availabilities || []).find(a => a.name === userName);
                if (!user) {
                    user = { name: userName, available: [dateStr], busy: [] };
                    newData.availabilities = [...(newData.availabilities || []), user];
                } else {
                    const isAvail = (user.available || []).includes(dateStr);
                    const isBusy = (user.busy || []).includes(dateStr);
                    if (!isAvail && !isBusy) user.available = [...(user.available || []), dateStr];
                    else if (isAvail) { user.available = user.available.filter(d => d !== dateStr); user.busy = [...(user.busy || []), dateStr]; }
                    else user.busy = (user.busy || []).filter(d => d !== dateStr);
                }
                setData(newData);
            };

            const handleVote = (category, opt) => {
                const newData = {...data};
                if (!newData.preferences) newData.preferences = { accommodationVotes: {}, durationVotes: {} };
                const field = category === 'accommodation' ? 'accommodationVotes' : 'durationVotes';
                const votes = newData.preferences[field][opt] || [];
                newData.preferences[field][opt] = votes.includes(userName) ? votes.filter(u => u !== userName) : [...votes, userName];
                setData(newData);
            }

            if (!isLoggedIn) {
                return html`
                    <div class="min-h-screen bg-fun-gradient flex items-center justify-center p-4">
                        <div class="max-w-md w-full bg-white/90 backdrop-blur-xl rounded-[3rem] shadow-2xl p-10 border border-white text-center relative overflow-hidden">
                            <!-- ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á (‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå/‡∏ï‡πâ‡∏ô‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß) ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á -->
                            <div class="absolute top-0 right-0 p-4 opacity-10 rotate-12"><${Icon} name="Sun" size="80" className="text-orange-400" /></div>
                            <div class="absolute bottom-0 left-0 p-4 opacity-10 -rotate-12"><${Icon} name="Palmtree" size="80" className="text-green-400" /></div>
                            
                            <div class="relative inline-block mb-8">
                                <div class="bg-gradient-to-tr from-blue-600 to-cyan-400 w-24 h-24 rounded-[2rem] flex items-center justify-center mx-auto shadow-2xl animate-float">
                                    <${Icon} name="MapPin" size="40" className="text-white" />
                                </div>
                                <div class="absolute -top-3 -right-3 bg-yellow-400 p-2.5 rounded-full shadow-lg animate-bounce">
                                    <${Icon} name="Sparkles" size="20" className="text-white" />
                                </div>
                            </div>
                            <h1 class="text-4xl font-black text-slate-800 mb-2 tracking-tight leading-tight">‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ô! üå¥</h1>
                            <p class="text-slate-500 mb-10 font-bold italic tracking-wide text-xs text-sm leading-relaxed">‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
                            <div class="space-y-4 relative z-10">
                                <input type="text" class="w-full px-8 py-5 rounded-3xl border-2 border-slate-100 focus:border-blue-500 focus:ring-8 focus:ring-blue-500/5 outline-none transition-all text-center text-xl font-extrabold shadow-inner bg-white" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" value=${userName} onChange=${e => setUserName(e.target.value)} onKeyDown=${e => e.key === 'Enter' && userName && setIsLoggedIn(true)} />
                                <button onClick=${() => userName && setIsLoggedIn(true)} class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-black py-5 rounded-3xl hover:shadow-2xl shadow-blue-200 transform active:scale-95 transition-all text-xl font-bold">‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏¢! üöÄ</button>
                            </div>
                        </div>
                    </div>`;
            }

            return html`
                <div class="min-h-screen bg-slate-50 pb-24 text-slate-700">
                    ${showSuccessModal && html`
                        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 text-center">
                            <div class="bg-white rounded-[2.5rem] p-10 max-w-xs w-full shadow-2xl border border-slate-100 animate-in fade-in zoom-in duration-300">
                                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600 shadow-inner">
                                    <${Icon} name="CheckCircle" size="48" />
                                </div>
                                <h3 class="text-2xl font-black text-slate-800 mb-2 tracking-tight">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                                <p class="text-slate-500 text-sm mb-8 font-medium leading-relaxed">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                                <button onClick=${() => setShowSuccessModal(false)} class="w-full bg-slate-100 hover:bg-slate-200 py-4 rounded-2xl font-black text-slate-700 transition-colors">‡∏ï‡∏Å‡∏•‡∏á</button>
                            </div>
                        </div>`}
                    <header class="bg-white/80 backdrop-blur-md border-b p-4 sticky top-0 z-50 flex justify-between items-center shadow-sm px-6">
                        <div class="flex items-center gap-2 font-black text-blue-600 uppercase tracking-tighter text-lg leading-none">
                            <${Icon} name="MapPin" size="20" /> Trip Buddy
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-xs font-black bg-blue-50 px-4 py-2 rounded-full text-blue-600 border border-blue-100 shadow-sm">${userName}</div>
                            <button onClick=${() => setIsLoggedIn(false)} class="text-slate-300 hover:text-red-500 transition-colors p-2"><${Icon} name="LogOut" size="18"/></button>
                        </div>
                    </header>
                    <main class="p-4 md:p-8 max-w-3xl mx-auto space-y-6">
                        <div class="flex bg-white p-2 rounded-3xl border shadow-sm gap-1">
                            <button onClick=${() => setActiveTab('availability')} class=${`flex-1 py-4 rounded-2xl font-black transition-all ${activeTab === 'availability' ? 'bg-blue-600 text-white shadow-xl shadow-blue-100' : 'text-slate-400 hover:bg-slate-50'}`}>1. ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏á</button>
                            <button onClick=${() => setActiveTab('vote')} class=${`flex-1 py-4 rounded-2xl font-black transition-all ${activeTab === 'vote' ? 'bg-blue-600 text-white shadow-xl shadow-blue-100' : 'text-slate-400 hover:bg-slate-50'}`}>2. ‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡πÑ‡∏ï‡∏•‡πå</button>
                        </div>
                        ${activeTab === 'availability' ? html`
                            <div class="bg-white p-6 md:p-8 rounded-[2.5rem] border shadow-sm space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div class="flex justify-between items-center flex-wrap gap-4">
                                    <h2 class="font-black text-2xl tracking-tight text-slate-800 leading-tight">‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h2>
                                    <div class="flex items-center gap-2 bg-slate-50 p-1.5 rounded-2xl border text-sm font-black">
                                        <button onClick=${() => setViewMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()-1))} class="p-2 hover:bg-white rounded-xl transition-colors shadow-sm"><${Icon} name="ChevronLeft" size={16}/></button>
                                        <span class="w-32 text-center text-slate-700">${months[viewMonth.getMonth()]} ${viewMonth.getFullYear()+543}</span>
                                        <button onClick=${() => setViewMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1))} class="p-2 hover:bg-white rounded-xl transition-colors shadow-sm"><${Icon} name="ChevronRight" size={16}/></button>
                                    </div>
                                </div>
                                <div class="bg-blue-50 p-5 rounded-3xl flex gap-4 text-sm text-blue-800 border border-blue-100 shadow-inner font-medium italic leading-relaxed">
                                    <${Icon} name="Info" size="20" className="text-blue-600 shrink-0"/>
                                    <div>‡∏Ñ‡∏•‡∏¥‡∏Å 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á = <strong>‡∏ß‡πà‡∏≤‡∏á (‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô)</strong> | 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á = <strong>‡∏ï‡∏¥‡∏î‡∏ò‡∏∏‡∏£‡∏∞ (‡πÅ‡∏î‡∏á)</strong></div>
                                </div>
                                <div class="grid grid-cols-7 gap-1 text-center font-black text-[11px] text-slate-300 uppercase tracking-[0.2em] mb-2">
                                    ${['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'].map(d => html`<div key=${d} class="py-2">${d}</div>`)}
                                </div>
                                <div class="grid grid-cols-7 gap-3">
                                    ${Array(viewMonth.getDay()).fill(null).map((_, i) => html`<div key=${`e-${i}`}/>`)}
                                    ${daysInMonth.map(date => {
                                        const dStr = date.toISOString().split('T')[0];
                                        const user = (data.availabilities || []).find(a => a.name === userName);
                                        const isAvail = user && (user.available || []).includes(dStr);
                                        const isBusy = user && (user.busy || []).includes(dStr);
                                        return html`
                                            <button key=${dStr} onClick=${() => toggleDateStatus(dStr)} class=${`aspect-square rounded-2xl border-2 flex items-center justify-center font-extrabold text-base transition-all transform active:scale-90 ${isAvail ? 'bg-blue-600 border-blue-600 text-white shadow-xl shadow-blue-100' : isBusy ? 'bg-red-500 border-red-500 text-white shadow-xl shadow-red-100' : 'bg-white border-slate-100 text-slate-400 hover:border-blue-200'}`}>
                                                ${date.getDate()}
                                            </button>`;
                                    })}
                                </div>
                                <div class="pt-8 border-t text-center">
                                    <button onClick=${() => syncToCloud(data, true)} disabled=${isSaving} class="w-full bg-green-600 hover:bg-green-700 text-white font-black py-5 rounded-3xl flex items-center justify-center gap-3 shadow-2xl transition-all active:scale-95 disabled:opacity-50 text-lg font-bold leading-none">
                                        ${isSaving ? html`<div class="w-6 h-6 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>` : html`<${Icon} name="Check" size="20" /> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏á`}
                                    </button>
                                </div>
                            </div>` : html`
                            <div class="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm space-y-8">
                                    <h2 class="font-black text-2xl flex items-center gap-3 text-slate-800 tracking-tight leading-tight"><${Icon} name="Users" size="24" className="text-blue-600"/> ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö</h2>
                                    <div class="space-y-8">
                                        <div>
                                            <h3 class="text-xs font-black text-slate-400 mb-4 uppercase tracking-[0.2em] flex items-center gap-2"><${Icon} name="Clock" size={14} /> ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏£‡∏¥‡∏õ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠)</h3>
                                            <div class="grid grid-cols-2 gap-3">
                                                ${["1 ‡∏ß‡∏±‡∏ô", "2 ‡∏ß‡∏±‡∏ô 1 ‡∏Ñ‡∏∑‡∏ô", "3 ‡∏ß‡∏±‡∏ô 2 ‡∏Ñ‡∏∑‡∏ô", "4 ‡∏ß‡∏±‡∏ô 3 ‡∏Ñ‡∏∑‡∏ô"].map(opt => html`
                                                    <button key=${opt} onClick=${() => handleVote('duration', opt)} class=${`p-5 rounded-[1.5rem] border-2 text-sm font-black text-left transition-all ${ (data.preferences?.durationVotes?.[opt] || []).includes(userName) ? 'bg-blue-600 border-blue-600 text-white shadow-xl shadow-blue-100' : 'bg-slate-50 border-slate-100 hover:bg-slate-100'}`}>${opt}</button>`)}
                                            </div>
                                        </div>
                                        <div>
                                            <h3 class="text-xs font-black text-slate-400 mb-4 uppercase tracking-[0.2em] flex items-center gap-2"><${Icon} name="Home" size={14} /> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠)</h3>
                                            <div class="grid grid-cols-2 gap-3">
                                                ${['‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°', '‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå', 'Pool Villa', '‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå', '‡∏£‡∏µ‡∏™‡∏≠‡∏£‡πå‡∏ó'].map(opt => html`
                                                    <button key=${opt} onClick=${() => handleVote('accommodation', opt)} class=${`p-5 rounded-[1.5rem] border-2 text-sm font-black text-left transition-all ${ (data.preferences?.accommodationVotes?.[opt] || []).includes(userName) ? 'bg-blue-600 border-blue-600 text-white shadow-xl shadow-blue-100' : 'bg-slate-50 border-slate-100 hover:bg-slate-100'}`}>${opt}</button>`)}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm space-y-8">
                                    <h2 class="font-black text-2xl flex items-center gap-3 text-slate-800 tracking-tight leading-tight"><${Icon} name="Palmtree" size={24} className="text-green-500"/> ‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß & ‡πÇ‡∏´‡∏ß‡∏ï</h2>
                                    <div class="flex gap-3">
                                        <input type="text" class="flex-1 bg-slate-50 border-2 border-slate-100 rounded-2xl px-6 py-5 outline-none focus:border-blue-500 transition-all font-bold shadow-inner" placeholder="‡πÄ‡∏™‡∏ô‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà..." value=${newLocationName} onChange=${e => setNewLocationName(e.target.value)} />
                                        <button onClick=${() => { if(!newLocationName) return; const newData={...data, destinations:[...(data.destinations||[]), {id:Date.now(), name:newLocationName, votes:[userName]}]}; setData(newData); setNewLocationName(''); }} class="bg-blue-600 text-white p-5 rounded-2xl shadow-xl hover:bg-blue-700 active:scale-90 transition-all"><${Icon} name="Plus" size="20" /></button>
                                    </div>
                                    <div class="grid grid-cols-1 gap-4">
                                        ${(data.destinations || []).map(dest => html`
                                            <div key=${dest.id} class="flex items-center justify-between p-6 bg-slate-50 rounded-3xl border-2 border-white shadow-sm font-black hover:shadow-md transition-all group">
                                                <span class="text-slate-700 text-lg font-black leading-tight">${dest.name}</span>
                                                <button onClick=${() => { const newData={...data}; newData.destinations = newData.destinations.map(d => d.id === dest.id ? {...d, votes: (Array.isArray(d.votes) ? d.votes : []).includes(userName) ? d.votes.filter(u=>u!==userName) : [...(Array.isArray(d.votes) ? d.votes : []), userName]} : d); setData(newData); }} class=${`p-4 rounded-2xl transition-all ${ (Array.isArray(dest.votes) ? dest.votes : []).includes(userName) ? 'bg-blue-600 text-white shadow-xl scale-110' : 'bg-white text-slate-300 border border-slate-100' }`}><${Icon} name="ThumbsUp" size="20"/></button>
                                            </div>`)}
                                    </div>
                                </div>

                                <button onClick=${() => syncToCloud(data, true)} disabled=${isSaving} class="w-full bg-gradient-to-r from-green-600 to-emerald-500 text-white font-black py-6 rounded-[2rem] shadow-2xl transform active:scale-95 transition-all text-xl font-bold leading-none">
                                    ${isSaving ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..." : "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ü•Ç"}
                                </button>
                            </div>`}
                    </main>
                </div>`;
        };

        ReactDOM.createRoot(document.getElementById('root')).render(html`<${App} />`);
    </script>
</body>
</html>
